---
title: 쿠버네티스(Kubernetes)
categories:
- Docker-Kubernetes
tags: 
- 2021년 10월

last_modified_at: 2021-10-12T14:00:00+09:00
toc: true
---

**컨테이너 인프라 환경이란 리눅스 운영 체제의 커널 하나에서 여러 개의 컨테이너가 격리된 상태로 실행되는 인프라 환경을 말한다**. 여기서 컨테이너는 하나 이상의 목적을 위해 독립적으로 작동하는 프로세스를 뜻한다.

## <span style="color:MediumSeaGreen">컨테이너 오케스트레이션</span>
실제로 쿠버네스트는 컨테이너 오케스트레이션을 위한 솔루션으로, **오케스트레이션이란 복잡한 단계를 관리하고 요소들의 유기적인 관계를 미리 정의해 손쉽게 사용하도록 서비스를 제공하는 것을 뜻한다**.  

다수의 컨테이너를 유기적으로 연결, 실행, 종료할 뿐만 아니라 상태를 추적하고 보존하는 등 컨테이너를 안정적으로 사용할 수 있게 만들어주는 것이 컨테이너 오케스트레이션이다.  

***

###### <span style="color:DodgerBlue">도커 스웜(Docker Swarm)</span>
간단하게 설치할 수 있고 사용하기도 용이하다. 그러나 그만큼 기능이 다양하지 않아 대규모 환경에 적용하려면 사용자 환경을 변경해야 할 수 있다. 그리하여 `소규모 환경에서는 유용하지만, 대규모 환경에서는 잘 사용하지 않는다.`

***

###### <span style="color:DodgerBlue">메소스(Mesos)</span>
아파치의 오픈 소스 프로젝트로 역사와 전통이 있는 클러스터 도구이며 다양한 곳에서 충분히 검증된 솔루션이다. 메소스는 매우 간결하지만, `기능을 충분히 활용하려면 분산 관리 시스탬과 연동해야 하기 때문에 여러가지 솔루션을 유기적으로 구성해야 하는 부담이 있다.`

***

###### <span style="color:DodgerBlue">노매드(Nomad)</span>
베어그런트를 만든 해시코프사의 컨테이너 오케스트레이션으로, 베이그런트처럼 간단한 구성으로 컨테이너 오케스트레이션 환경을 제공한다. 하지만 도커 스웜과 마찬가지로 기능이 부족하므로 복잡하게 여러 기능을 사용하는 환경이 아닌 가볍고 간단한 기능만 필요한 환경에서 사용하는 것이 좋다.

***

###### <span style="color:DodgerBlue">쿠버네티스(Kubernetes)</span>
다른 오케스트레이션 솔루션보다는 시작하는 데 어려움이 있지만, 쉽게 사용할 수 있도록 도와주는 도구들이 있어서 설치가 쉬워지는 추세이다. 또 다양한 형태의 쿠버네티스가 지속적으로 계속 발전되고 있어 컨테이너 오케스트레이션을 넘어 IT 인프라 자체를 컨테이너화하고, 컨테이너화된 인프라 제품군을 쿠버네티스 위에서 동작할 수 있게 만든다.

***

- 컨테이너 오케스트레이션 솔루션 비교  

|구분|도커 스윔|메소스|노매드|쿠버네티스|
|:------:|:---:|:---:|:---:|:---:|
|설치 난이도|쉬움|매우 어려움|쉬움|어려움|
|사용 편의성|매우 좋음|좋음|매우 좋음|좋음|
|세부 설정 지원|거의 없음|있음|거의 없음|다양하게 있음|
|안정성|매우 안정적임|안정적임|안정적엄|매우 안정적임|
|확장성|어려움|매우 잘 됨|어려움|매우 잘 됨|
|정보량|많음|적음|적음|매우 많음|
|에코 파트너|없음|거의 없음|있음|매우 많음|
|학습 곡선|쉬움|매우 어려움|어려움|어려움|

***

###### <span style="color:DodgerBlue">쿠버네티스 구성 방법</span>
1. 퍼블릭 클라우드 업체에서 제공하는 **관리형 쿠버네티스**인 EKS, AKS, GKE 등을 사용한다. 구성이 이미 갖춰져 있고 마스터 노드를 크라우드 업체에서 관리함으로 학습용으로는 부적합하다.

2. 수세의 Rancher, 레드햇의 OpenShift와 같은 플랫폼에서 제공하는 **설치형 쿠버네티스**를 사용한다. `허나 유료다.`

3. 사용하는 시스템에 쿠버네티스 클러스터를 **자동으로 구성해주는 솔루션을 사용**한다. 주요 솔루션으로는 kubeadm, kops, KBIB, kubespray가 있다. 이 중 kubeadm이 가장 잘 알려져 있고, 사용자가 변경하기도 수월하며, 온프레미스와 클라우드를 모두 지원한다.


***

- 쿠버네티스 클러스터 구성 솔루션 비교  

|구분|도커 스윔|메소스|노매드|쿠버네티스|
|:------:|:---:|:---:|:---:|:---:|
|정보량|적음|많음|많음|매우 많음|
|세부 설정 변경|가능함|가능함|제한적으로 가능함|다양함|
|사전 요구 조건|적음|적음|적음|매우 적음|
|온프레미스 지원|매우 좋음|안됨|좋음|매우 좋음|
|클라우드 지원|안 됨|매우 좋음|좋음|좋음|
|학습 곡선|매우 어려움|어려움|쉬움|어려움|
|자동화 기능|제공됨|제공됨|쉽게 제공됨|제한적으로 제공됨|

***

###### <span style="color:DodgerBlue">파드를 배포할 때</span>
쿠버네스트의 구성 요소의 유기적인 연결관계를 그림으로 표현하면 다음과 같다.  
그림에 표시된 숫자는 실제로 관리자나 개발자가 파드 배포 명령을 수행했을 때 실행되는 순서다.  

![img.png](/assets/images/kubernetes1.jpeg)  


<h4 style="color:MediumSlateBlue">마스터 노드</h4>

**⓪. kubectl** : 쿠버네티스 클러스터에 명령을 내리는 역할을 한다. 다른 구성 요소들과 다르게 바로 실행되는 명령 형태인 바이너리(binary)로 배포되기 때문에 마스터 노드에 있을 필요는 없다. 허나, 통상적으로 API 서버와 주로 통신하므로 마스터 노드에 구성하였다.

**①. API 서버** : 쿠버네티스 클러스터의 중심 역할을 하는 통로이다. 주로 상태 값을 저장하는 etcd와 통신하지만, 그 밖의 요소들 또한 API 서버를 중심에 두고 통신하므로 API 서버의 역할이 매우 중요하다.

**②. etcd** : 구성 요소들의 상태 값이 모두 저장되는 곳이다. 회사의 관리자가 모든 보고 내용을 기록하는 노트라고 생각하면 된다. 실제로 etcd 외의 다른 구성 요소는 상태 값을 관리하지 않는다. 그러므로 etcd의 정보만 백업되어 있다면 장애 상황에서도 쿠버네티스 클러스터는 복구할 수 있다. 또한 etcd는 `분산 저장이 가능한 key-value 저장소`이므로, 복제해 여러 곳에 저장해 두면 하나의 etcd에서 장애가 나더라도 시스템의 가용성을 확보할 수 있다.

**③. 컨트롤러 매니저** : 컨트롤러 매니저는 쿠버네티스 클러스터의 오브젝트 상태를 관리한다. 예를 들어 워커 노드에서 통신이 되지 않는 경우, 상태 체크와 복구는 컨트롤러 매니어제 속한 노드 컨트롤러에서 이뤄진다. 다양한 상태 값을 관리하는 주체들이 컨트롤러 매니저에 소속되어 각자의 역할을 수행한다.

**④. 스케줄러** : 노드의 상태와 자원, 레이블, 요구 조건 등을 고려해 파드를 어떤 워커 노드에 생성할 것인지를 결정하고 할당한다. 스케줄러라는 이름에 맞게 파드를 조건에 맞는 워커 노드에 지정하고, 파드가 워커 노드에 할당되는 일정을 관리한다.

<h4 style="color:MediumSlateBlue">워커 노드</h4>  

**⑤. kubelet** : 파드의 구성 내용(PodSpec)을 받아서 컨테이너 런타임으로 전달하고, 파드 안의 컨테이너들이 정상적으로 작동하는지 모니터링 한다.

**⑥. 컨테이너 런타임(CRI)** : 파드를 이루는 컨테이너의 실행을 담당한다. 파드 안에서 다양한 종류의 컨테이너가 문제 없이 작동하게 만드는 표준 인터페이스이다.

**⑦. 파드(Pod)** : 한 개 이상의 컨테이너로 단일 목적의 일을 하기 위해서 모인 단위이다. 즉, 웹서버 역할을 할 수도 있고 로그나 데이터를 분석할 수도 있다. 중요한 것은 `파드는 언제라도 죽을 수 있는 존재라는 점`이다. 
  

***

<span style="color:DarkOrange">reference</span>  
조훈·심근우·문성주 (2021). 컨테이너 인프라 환경 구축을 위한 쿠버네티스/도커. 길벗