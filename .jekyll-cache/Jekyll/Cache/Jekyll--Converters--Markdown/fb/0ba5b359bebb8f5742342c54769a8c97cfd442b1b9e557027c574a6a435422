I"<h2 id="플러시flush">플러시(flush)</h2>
<ul>
  <li><strong>플러시(flush)는 영속성 컨텍스트의 변경 내용을 데이터베이스에 반영</strong>하는 것이다.</li>
  <li>데이터베이스 transaction commit이 발생하면 <strong>자동 플러시(flush)</strong> 됨</li>
</ul>

<hr />

<h6 id="플러시flush-발생">플러시(flush) 발생</h6>
<ul>
  <li>플러시(flush)가 발생하면 다음과 같은 일이 발생한다.
    <ol>
      <li>변경 감지(Dirty checking) 발생</li>
      <li>수정된 엔티티의 내용을 쓰기 지연 SQL 저장소에 등록</li>
      <li>쓰기 지연 SQL 저장소의 query를 데이터베이스에 전송(등록, 수정, 삭제)</li>
    </ol>
  </li>
</ul>

<hr />

<h6 id="영속성-컨텍스트를-플러시flush하는-방법">영속성 컨텍스트를 플러시(flush)하는 방법</h6>
<ul>
  <li>개발을 하면서 직접 flush 할 일은 거의 없지만, 아래와 같은 행동을 했을 때 발생한다.
    <ol>
      <li>em.flush - 직접 호출</li>
      <li>transaction commit - 자동 호출</li>
      <li>JPQL query 실행 - 자동 호출</li>
    </ol>
  </li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">Member</span> <span class="n">member</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Member</span><span class="o">(</span><span class="mi">3L</span><span class="o">,</span> <span class="s">"member3"</span><span class="o">);</span>
<span class="n">em</span><span class="o">.</span><span class="na">persist</span><span class="o">(</span><span class="n">member</span><span class="o">);</span>

<span class="c1">// flush 시점에 Insert query 실행</span>
<span class="n">em</span><span class="o">.</span><span class="na">flush</span><span class="o">();</span>

<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"============================"</span><span class="o">);</span>

<span class="n">tx</span><span class="o">.</span><span class="na">commit</span><span class="o">();</span>
</code></pre></div></div>

<p><img src="/assets/images/jpa/flush/flush.png" alt="img.png" /></p>
<ul>
  <li>transaction.commit()전에 flush를 호출하였더니 DB에 Insert query를 보낸다.</li>
</ul>

<hr />

<h3 id="플러시flush-모드-옵션">플러시(flush) 모드 옵션</h3>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">em</span><span class="o">.</span><span class="na">setFlushMode</span><span class="o">(</span><span class="nc">FlushModeType</span><span class="o">.</span><span class="na">COMMIT</span><span class="o">)</span>
</code></pre></div></div>

<ul>
  <li>FlushModeType.AUTO
    <ul>
      <li>commit 또는 query를 실행할 때 플러시(기본 값)</li>
    </ul>
  </li>
  <li>FlushModeType.Commit
    <ul>
      <li>commit할 때만 플러시</li>
    </ul>
  </li>
</ul>

<hr />

:ET